<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .search-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .stats-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .loading {
            display: none;
        }
        .pagination .page-link {
            color: #007bff;
        }
        .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .table .badge {
            font-size: 0.9em;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center text-primary">
                    <i class="fas fa-graduation-cap me-2"></i>
                    Student Management System
                </h1>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="search-box">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="input-group">
                        <span class="input-group-text bg-white">
                            <i class="fas fa-search text-primary"></i>
                        </span>
                        <input type="text" id="searchInput" class="form-control" placeholder="Search by name or roll number...">
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <select id="sectionFilter" class="form-select">
                        <option value="">All Sections</option>
                        <option value="A1">Section A1</option>
                        <option value="A2">Section A2</option>
                        <option value="A3">Section A3</option>
                        <option value="B1">Section B1</option>
                        <option value="B2">Section B2</option>
                        <option value="B3">Section B3</option>
                        <option value="C1">Section C1</option>
                        <option value="C2">Section C2</option>
                        <option value="C3">Section C3</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <select id="statusFilter" class="form-select">
                        <option value="">All Students</option>
                        <option value="active">Active Only</option>
                        <option value="suspended">Suspended Only</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="stats-card text-center">
                    <h3 id="totalStudents">0</h3>
                    <p class="mb-0">Total Students</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="stats-card text-center" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3 id="suspendedStudents">0</h3>
                    <p class="mb-0">Suspended Students</p>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="text-center loading" id="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading students...</p>
        </div>

        <!-- Students Table -->
        <div id="studentsContainer" class="mb-4">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Roll Number</th>
                        <th>Section</th>
                        <th>Batch</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="studentsTableBody">
                    <!-- Students will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="row mt-4">
            <div class="col-12">
                <nav aria-label="Students pagination">
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- Pagination will be generated here -->
                    </ul>
                </nav>
            </div>
        </div>

        <!-- No Results Message -->
        <div id="noResults" class="text-center mt-4" style="display: none;">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No students found</h4>
            <p class="text-muted">Try adjusting your search criteria</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let allStudents = [];
        let filteredStudents = [];
        let currentPage = 1;
        const studentsPerPage = 50;

        // API Base URL
        const API_BASE = 'http://localhost:5000/api';

        // Load students on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadStudents();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', debounce(filterStudents, 300));
            document.getElementById('sectionFilter').addEventListener('change', filterStudents);
            document.getElementById('statusFilter').addEventListener('change', filterStudents);
        }

        async function loadStudents() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/students`);
                const data = await response.json();
                
                if (data.success) {
                    allStudents = data.students;
                    filteredStudents = [...allStudents];
                    updateStatistics();
                    displayStudents();
                } else {
                    showError('Failed to load students');
                }
            } catch (error) {
                showError('Error connecting to server');
                console.error('Error:', error);
            } finally {
                showLoading(false);
            }
        }

        function filterStudents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sectionFilter = document.getElementById('sectionFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredStudents = allStudents.filter(student => {
                const matchesSearch = !searchTerm || 
                    student.name.toLowerCase().includes(searchTerm) ||
                    student.rollNumber.toLowerCase().includes(searchTerm);
                const matchesSection = !sectionFilter || student.section === sectionFilter;
                let matchesStatus = true;
                if (statusFilter === 'active') {
                    matchesStatus = !student.isSuspended;
                } else if (statusFilter === 'suspended') {
                    matchesStatus = student.isSuspended;
                }
                return matchesSearch && matchesSection && matchesStatus;
            });

            currentPage = 1;
            displayStudents();
        }

        function displayStudents() {
            const tableBody = document.getElementById('studentsTableBody');
            const noResults = document.getElementById('noResults');
            
            if (filteredStudents.length === 0) {
                tableBody.innerHTML = '';
                noResults.style.display = 'block';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            noResults.style.display = 'none';

            const startIndex = (currentPage - 1) * studentsPerPage;
            const endIndex = startIndex + studentsPerPage;
            const currentStudents = filteredStudents.slice(startIndex, endIndex);

            tableBody.innerHTML = currentStudents.map(student => `
                <tr class="${student.isSuspended ? 'table-danger' : ''}">
                    <td>${student.name}</td>
                    <td>${student.rollNumber}</td>
                    <td>${student.section}</td>
                    <td>${student.batch}</td>
                    <td>
                        <span class="badge ${student.isSuspended ? 'bg-danger' : 'bg-success'}">
                            ${student.isSuspended ? 'Suspended' : 'Active'}
                        </span>
                    </td>
                </tr>
            `).join('');

            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Previous</a>
                </li>
            `;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }

            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Next</a>
                </li>
            `;

            pagination.innerHTML = paginationHTML;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayStudents();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateStatistics() {
            const total = allStudents.length;
            const suspended = allStudents.filter(s => s.isSuspended).length;

            document.getElementById('totalStudents').textContent = total;
            document.getElementById('suspendedStudents').textContent = suspended;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            alert(message);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>